

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cframe &mdash; cframe 0.3 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="cframe 0.3 documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> cframe</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iscas.html">ISCAS89 Format</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../iscas.html#comments">Comments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iscas.html#ports">Ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iscas.html#gates">Gates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cframe.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">cframe</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>cframe</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for cframe</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;*cframe* is a Python port of the C++ CFRAME library used in 18-765&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">functools</span>

<div class="viewcode-block" id="Roth"><a class="viewcode-back" href="../cframe.html#cframe.Roth">[docs]</a><span class="k">class</span> <span class="nc">Roth</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Roth implements the Roth 5-value algebra as an enumerated class.</span>

<span class="sd">    The 5 values in the Roth algebra are:</span>
<span class="sd">       - Zero</span>
<span class="sd">       - One</span>
<span class="sd">       - D</span>
<span class="sd">       - D_b</span>
<span class="sd">       - X</span>

<span class="sd">    Each Roth value has corresponding member of this class with a name</span>
<span class="sd">    (exactly as above) and integer value (used to create lookup tables for</span>
<span class="sd">    operations).</span>

<span class="sd">    Examples:</span>
<span class="sd">       &gt;&gt;&gt; a = Roth.One</span>
<span class="sd">       &gt;&gt;&gt; print(a)</span>
<span class="sd">       Roth.One</span>
<span class="sd">       &gt;&gt;&gt; print(a.name)</span>
<span class="sd">       One</span>
<span class="sd">       &gt;&gt;&gt; print(a.value)</span>
<span class="sd">       1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># pylint: disable=invalid-name</span>
    <span class="n">Zero</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">One</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">D</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">D_b</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">X</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Roth.invert"><a class="viewcode-back" href="../cframe.html#cframe.Roth.invert">[docs]</a>    <span class="k">def</span> <span class="nf">invert</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Invert the provided Roth value.</span>

<span class="sd">        Args:</span>
<span class="sd">           val (Roth): Roth value to invert.</span>

<span class="sd">        Returns:</span>
<span class="sd">           Roth: The inverted Roth value.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># INV lookup table</span>
        <span class="n">invert</span> <span class="o">=</span> <span class="p">{</span><span class="n">Roth</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span> <span class="n">Roth</span><span class="o">.</span><span class="n">One</span><span class="p">,</span>
                  <span class="n">Roth</span><span class="o">.</span><span class="n">One</span><span class="p">:</span> <span class="n">Roth</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span>
                  <span class="n">Roth</span><span class="o">.</span><span class="n">D</span><span class="p">:</span> <span class="n">Roth</span><span class="o">.</span><span class="n">D_b</span><span class="p">,</span>
                  <span class="n">Roth</span><span class="o">.</span><span class="n">D_b</span><span class="p">:</span> <span class="n">Roth</span><span class="o">.</span><span class="n">D</span><span class="p">,</span>
                  <span class="n">Roth</span><span class="o">.</span><span class="n">X</span><span class="p">:</span> <span class="n">Roth</span><span class="o">.</span><span class="n">X</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">invert</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
        </div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Roth.operate"><a class="viewcode-back" href="../cframe.html#cframe.Roth.operate">[docs]</a>    <span class="k">def</span> <span class="nf">operate</span><span class="p">(</span><span class="n">optype</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform operation on collection of Roth values.</span>

<span class="sd">        Supported operations are AND, OR, and XOR. The operation is accumulated</span>
<span class="sd">        across all Roth values in the provided iterable.</span>

<span class="sd">        Args:</span>
<span class="sd">           optype (str): String indicating which operation to perform.</span>
<span class="sd">           inputs (iterable): Iterable collection of Roth values.</span>

<span class="sd">        Returns:</span>
<span class="sd">           Roth: Operation result.</span>

<span class="sd">        Raises:</span>
<span class="sd">           KeyError: If optype is not a supported operation (AND, OR, XOR).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Dictionary of ops with integer lookup tables keyed to Roth enum values</span>
        <span class="n">optables</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;AND&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
                    <span class="s">&quot;OR&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
                    <span class="s">&quot;XOR&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]}</span>

        <span class="k">if</span> <span class="n">optype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">optables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Unrecognized optype </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">optype</span><span class="p">))</span>

        <span class="c"># Accumulate operation across provided iterable. Note that the iterable</span>
        <span class="c"># needs to be converted from Roth type to integer values for use with</span>
        <span class="c"># the integer lookup tables defined in optables.</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">optables</span><span class="p">[</span><span class="n">optype</span><span class="p">][</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">],</span>
                                  <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">))</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Roth: operate</span><span class="se">\t</span><span class="s">type:</span><span class="si">%s</span><span class="se">\t</span><span class="s">returns: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span>
                      <span class="n">optype</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                      <span class="n">Roth</span><span class="p">(</span><span class="n">retval</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Roth</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Gate"><a class="viewcode-back" href="../cframe.html#cframe.Gate">[docs]</a><span class="k">class</span> <span class="nc">Gate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gate implements an ISCAS-compatible gate.</span>

<span class="sd">    Supported gate types are stored as the class attribute Gate.types:</span>
<span class="sd">       - AND</span>
<span class="sd">       - NAND</span>
<span class="sd">       - OR</span>
<span class="sd">       - NOR</span>
<span class="sd">       - XOR</span>
<span class="sd">       - XNOR</span>
<span class="sd">       - BUFF</span>
<span class="sd">       - NOT</span>
<span class="sd">       - DFF</span>
<span class="sd">       - INPUT</span>
<span class="sd">       - UNDEFINED</span>

<span class="sd">    Note: DFF is currently a placeholder (has no functionality).</span>

<span class="sd">    Attributes:</span>
<span class="sd">       name (str): Name of the gate, also corresponds to the signal line</span>
<span class="sd">          driven by the gate.</span>
<span class="sd">       gatetype (str): String representing the type of gate, should be one</span>
<span class="sd">          of the types in Gate.types.</span>
<span class="sd">       fanin (list): List of gate names representing the fanin to the current</span>
<span class="sd">          gate.</span>
<span class="sd">       fanout (list): List of gate names representing the fanout of the current</span>
<span class="sd">          gate.</span>
<span class="sd">       value (Roth): Roth value representing current state of the gate.</span>
<span class="sd">       output (bool): Boolean flag indicating whether gate is a primary output.</span>
<span class="sd">       flag (bool): Boolean flag used to keep track of whether a gate has been</span>
<span class="sd">          processed during the course of some operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;AND&quot;</span><span class="p">,</span>
             <span class="s">&quot;NAND&quot;</span><span class="p">,</span>
             <span class="s">&quot;OR&quot;</span><span class="p">,</span>
             <span class="s">&quot;NOR&quot;</span><span class="p">,</span>
             <span class="s">&quot;XOR&quot;</span><span class="p">,</span>
             <span class="s">&quot;XNOR&quot;</span><span class="p">,</span>
             <span class="s">&quot;BUFF&quot;</span><span class="p">,</span>
             <span class="s">&quot;NOT&quot;</span><span class="p">,</span>
             <span class="s">&quot;DFF&quot;</span><span class="p">,</span>
             <span class="s">&quot;INPUT&quot;</span><span class="p">,</span>
             <span class="s">&quot;UNDEFINED&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">gatetype</span><span class="p">,</span> <span class="n">fanin</span><span class="o">=</span><span class="p">(),</span> <span class="n">fanout</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new Gate.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">           name (str): Name of the gate.</span>
<span class="sd">           gatetype (str): Type of the gate, should be one of Gate.types.</span>
<span class="sd">           fanin (iterable): List of gate names representing the fanin of</span>
<span class="sd">              this gate.</span>
<span class="sd">           fanout (iterable): List of gate names representing the fanout of</span>
<span class="sd">              this gate.</span>

<span class="sd">        Raises:</span>
<span class="sd">           KeyError: If gatetype is not one of Gate.types.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">if</span> <span class="n">gatetype</span> <span class="ow">in</span> <span class="n">Gate</span><span class="o">.</span><span class="n">types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">=</span> <span class="n">gatetype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Invalid gatetype: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">gatetype</span><span class="p">))</span>

        <span class="c"># Avoid shallow copies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fanin</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fanin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fanout</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fanout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;GATE: init</span><span class="se">\t</span><span class="s">name:</span><span class="si">%s</span><span class="se">\t</span><span class="s">type:</span><span class="si">%s</span><span class="se">\t</span><span class="s">#in:</span><span class="si">%s</span><span class="se">\t</span><span class="s">#out:</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                      <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fanin</span><span class="p">))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                      <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fanout</span><span class="p">))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>

<div class="viewcode-block" id="Gate.evaluate"><a class="viewcode-back" href="../cframe.html#cframe.Gate.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ckt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate current gate based on circuit state.</span>

<span class="sd">        Note that this function both updates the value of the current gate and</span>
<span class="sd">        returns the new value based on the evaluation.</span>

<span class="sd">        Args:</span>
<span class="sd">           ctk (Circuit): Circuit containing current gate and all fanin gates.</span>

<span class="sd">        Returns:</span>
<span class="sd">           Roth: Updated Roth value of current gate based on evaluation of </span>
<span class="sd">              the fanin states.</span>

<span class="sd">        Raises:</span>
<span class="sd">           KeyError: If current gatetype is not in Gate.types.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Gate</span><span class="o">.</span><span class="n">types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Invalid gate type&quot;</span><span class="p">)</span>
            
        <span class="n">statein</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">fi</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fanin</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;AND&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="s">&quot;AND&quot;</span><span class="p">,</span> <span class="n">statein</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;NAND&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">Roth</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="s">&quot;AND&quot;</span><span class="p">,</span> <span class="n">statein</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;OR&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="s">&quot;OR&quot;</span><span class="p">,</span> <span class="n">statein</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;NOR&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">Roth</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="s">&quot;OR&quot;</span><span class="p">,</span> <span class="n">statein</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;XOR&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="s">&quot;XOR&quot;</span><span class="p">,</span> <span class="n">statein</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;XNOR&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">Roth</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="s">&quot;XOR&quot;</span><span class="p">,</span> <span class="n">statein</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;BUFF&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">statein</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;NOT&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">statein</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;DFF&quot;</span><span class="p">:</span>   <span class="c"># DFF not supported at this time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">X</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;UNDEFINED&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">X</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;GATE: eval</span><span class="se">\t</span><span class="s">name:</span><span class="si">%s</span><span class="se">\t</span><span class="s">inputs: </span><span class="si">%s</span><span class="se">\t</span><span class="s">result: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                      <span class="nb">str</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">statein</span><span class="p">]),</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

</div></div>
<div class="viewcode-block" id="Circuit"><a class="viewcode-back" href="../cframe.html#cframe.Circuit">[docs]</a><span class="k">class</span> <span class="nc">Circuit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Circuit implements an ISCAS-compatible circuit.</span>

<span class="sd">    This class provides functions and data structures for handling a collection</span>
<span class="sd">    of Gate objects that represent an ISCAS circuit. The heavy lifting is</span>
<span class="sd">    mostly done in the Roth and Gate objects, with Circuit providing convenient</span>
<span class="sd">    interfaces and tracking the important features.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       inputs (list): List of gate names corresponding to the inputs of the</span>
<span class="sd">          circuit.</span>
<span class="sd">       gatemap (dict): Dictionary mapping the names (str) of gates to the gate</span>
<span class="sd">          objects (Gate).</span>
<span class="sd">       outputs (list): List of the gate names corresponding to the outputs of</span>
<span class="sd">          the circuit.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new Circuit.</span>

<span class="sd">        Args:</span>
<span class="sd">           filename (str): Name of file to read to create circuit (optional).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_iscas</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="Circuit.reset_flags"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.reset_flags">[docs]</a>    <span class="k">def</span> <span class="nf">reset_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set gate flags to False for all gates in the circuit.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">gate</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Circuit.reset_values"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.reset_values">[docs]</a>    <span class="k">def</span> <span class="nf">reset_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set logic value for all gates in the circuit to &#39;X&#39;&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">gate</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Roth</span><span class="o">.</span><span class="n">X</span>
            </div>
<div class="viewcode-block" id="Circuit.set_inputs"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.set_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">set_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set circuit inputs to the provided values.</span>

<span class="sd">        Note the implicit order; the value in iterable values will be mapped</span>
<span class="sd">        in order to the gates in the Circuit.inputs list.</span>

<span class="sd">        Args:</span>
<span class="sd">           values (iterable): List of Roth values to be applied (in order) to</span>
<span class="sd">              the circuit inputs.</span>

<span class="sd">        Raises:</span>
<span class="sd">           IndexError: If the number of values provided does not match the</span>
<span class="sd">              number of circuit inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s">&quot;Mismatch between numbers of inputs and values&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iname</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">iname</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Circuit: set_inputs</span><span class="se">\t</span><span class="s"> </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Circuit.get_outputs"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.get_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">get_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve values on the outputs of the circuit.</span>

<span class="sd">        Returns:</span>
<span class="sd">           tuple: Tuple of Roth values on the outputs of the circuit (in order).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">out</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Circuit.add_gates"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.add_gates">[docs]</a>    <span class="k">def</span> <span class="nf">add_gates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a list of gate objects to the circuit.</span>

<span class="sd">        All of the gates provided are added to the circuit. Missing fanin</span>
<span class="sd">        connections will be discovered and result in an exception (see below).</span>

<span class="sd">        Args:</span>
<span class="sd">           gates (list): List of Gate objects to be added to the circuit.</span>

<span class="sd">        Raises:</span>
<span class="sd">           KeyError: If any fanin connections are attempted to gates that do</span>
<span class="sd">              not either already exist in the circuit or are being added as</span>
<span class="sd">              part of the current operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">gates</span><span class="p">:</span>   <span class="c"># First loop adds gates, tracks inputs/outputs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gate</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">gatetype</span> <span class="o">==</span> <span class="s">&quot;INPUT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Circuit: add_gates</span><span class="se">\t</span><span class="s">name:</span><span class="si">%s</span><span class="se">\t</span><span class="s">type: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span>
                          <span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                          <span class="n">gate</span><span class="o">.</span><span class="n">gatetype</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">gates</span><span class="p">:</span>   <span class="c"># Second loop attempts to connect fanin</span>
            <span class="k">for</span> <span class="n">fin</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">fanin</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>   <span class="c"># Catch error to provide a more useful error message</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">fin</span><span class="p">]</span><span class="o">.</span><span class="n">fanout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Cannot find fanin </span><span class="si">%s</span><span class="s"> for signal </span><span class="si">%s</span><span class="s">&quot;</span>
                                   <span class="o">%</span> <span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Circuit.read_iscas"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.read_iscas">[docs]</a>    <span class="k">def</span> <span class="nf">read_iscas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read ISCAS file into circuit.</span>
<span class="sd">        </span>
<span class="sd">        Note that erroneous ISCAS files may not cause this function to fail.</span>
<span class="sd">        This function should fail on most malformed lines (missing parens,</span>
<span class="sd">        etc.), non-ISCAS gates, and missing fanin gates. Other issues, such as</span>
<span class="sd">        feedback loops, will not be caught. It is recommended to verify</span>
<span class="sd">        both the original ISCAS file and the Circuit object returned by this</span>
<span class="sd">        function.</span>

<span class="sd">        Args:</span>
<span class="sd">           filename (str): Name of the ISCAS file to read.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;CIRCUIT: read_iscas called on file: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="c"># Open file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filep</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filep</span><span class="p">:</span>

                <span class="c"># New gate potentially defined by each line</span>
                <span class="n">fanin</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">Circuit</span><span class="o">.</span><span class="n">_tokenize</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="s">&#39;sigout&#39;</span><span class="p">:</span>   <span class="c"># Line to drive (gate name)</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">lit</span>
                    <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="s">&#39;gate&#39;</span><span class="p">:</span>   <span class="c"># Type of gate</span>
                        <span class="n">gatetype</span> <span class="o">=</span> <span class="n">lit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>   <span class="c"># Convert to uppercase</span>
                    <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="s">&#39;sigin&#39;</span><span class="p">:</span>   <span class="c"># Gate input (not last)</span>
                        <span class="n">fanin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="s">&#39;sigend&#39;</span><span class="p">:</span>   <span class="c"># Last gate input</span>
                        <span class="k">if</span> <span class="n">gatetype</span> <span class="o">==</span> <span class="s">&#39;OUTPUT&#39;</span><span class="p">:</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">gatetype</span> <span class="o">==</span> <span class="s">&#39;INPUT&#39;</span><span class="p">:</span>
                            <span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">lit</span><span class="p">,</span> <span class="n">gatetype</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fanin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
                            <span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gatetype</span><span class="p">,</span> <span class="n">fanin</span><span class="p">))</span>
                                
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">gates</span><span class="p">:</span>   <span class="c"># Loop to log gates read and set gate output flag</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;CIRCUIT: read_iscas</span><span class="se">\t</span><span class="s">gate:</span><span class="si">%s</span><span class="se">\t</span><span class="s">type:</span><span class="si">%s</span><span class="se">\t</span><span class="s">fanin: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span>
                          <span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                          <span class="n">gate</span><span class="o">.</span><span class="n">gatetype</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                          <span class="n">gate</span><span class="o">.</span><span class="n">fanin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
                <span class="n">gate</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_gates</span><span class="p">(</span><span class="n">gates</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Circuit.evaluate"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate and update each gate in the circuit from inputs to outputs.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">           RuntimeError: If circuit contains a feedback loop or is missing a</span>
<span class="sd">              path to an output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Need to reset all gate flags as they are used to track which gates</span>
        <span class="c"># have been evaluated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_flags</span><span class="p">()</span>

        <span class="c"># Create eval_frontier, fill with all level 1 gates (fed directly by</span>
        <span class="c"># the circuit inputs).</span>
        <span class="n">eval_frontier</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">delayed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">igate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">igate</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">fout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">igate</span><span class="p">]</span><span class="o">.</span><span class="n">fanout</span><span class="p">:</span>
                <span class="n">eval_frontier</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">fout</span><span class="p">])</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">eval_frontier</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">eval_frontier</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="c"># Note: this shouldn&#39;t happen as only untouched gates should be</span>
            <span class="c"># added to the eval_frontier.</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">flag</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c"># Check all fanin, skip if any fanin are untouched.</span>
            <span class="n">fanin_touched</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">fin</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span> <span class="k">for</span> <span class="n">fin</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">fanin</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">False</span> <span class="ow">in</span> <span class="n">fanin_touched</span><span class="p">:</span>
                <span class="n">delayed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c"># If execution reaches this point in the loop it should be safe to</span>
            <span class="c"># evaluate the current gate and mark it as touched.</span>
            <span class="n">target</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">target</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
            
            <span class="c"># Add all untouched fanout for current gate to eval_frontier</span>
            <span class="k">for</span> <span class="n">fout</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">fanout</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">fout</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span><span class="p">:</span>
                    <span class="n">eval_frontier</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">fout</span><span class="p">])</span>

            <span class="c"># Put back all skipped gates (might have been dependent on target)</span>
            <span class="n">eval_frontier</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">delayed</span><span class="p">)</span>
            <span class="n">delayed</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c"># Feedback loop is present if there are any gates in the delayed set</span>
        <span class="c"># after the loop exits.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">delayed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Feedback loop present in circuit&quot;</span><span class="p">)</span>
            
        <span class="c"># No path to primary output if any of the outputs are untouched</span>
        <span class="k">if</span> <span class="bp">False</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="p">[</span><span class="n">out</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span> <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;No path to primary output&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Circuit.print_summary"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.print_summary">[docs]</a>    <span class="k">def</span> <span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print circuit summary.&quot;&quot;&quot;</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">Gate</span><span class="o">.</span><span class="n">types</span><span class="p">}</span>
        <span class="n">counts</span><span class="p">[</span><span class="s">&quot;OUTPUTS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
        <span class="n">signals</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Count signals and gates</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">gatetype</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">fanout</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">signals</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>   <span class="c"># Add one for stem lines in the case of branching</span>
                <span class="n">signals</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">fanout</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;=====CIRCUIT SUMMARY=====&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Total signals:</span><span class="se">\t</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">signals</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;# </span><span class="si">%s%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">key</span><span class="o">+</span><span class="s">&quot;:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span> <span class="n">count</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Circuit.print_state"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.print_state">[docs]</a>    <span class="k">def</span> <span class="nf">print_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print circuit state.&quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;=====CIRCUIT STATE=====&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">gate</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> :</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Circuit.write_state"><a class="viewcode-back" href="../cframe.html#cframe.Circuit.write_state">[docs]</a>    <span class="k">def</span> <span class="nf">write_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write circuit state to file (Project 2 format).</span>

<span class="sd">        Args:</span>
<span class="sd">           outfile (file pointer): Open file for writing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Circuit State</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">gate</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gatemap</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Roth</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">Roth</span><span class="o">.</span><span class="n">One</span><span class="p">):</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;$</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        </div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_tokenize</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate meaningful tokens from a single line in an ISCAS file.</span>
<span class="sd">        </span>
<span class="sd">        Possible tokens are &quot;comment&quot;, &quot;sigout&quot;, &quot;gate&quot;, &quot;sigin&quot;, &quot;sigend&quot;,</span>
<span class="sd">        &quot;whitespace&quot;, and &quot;error&quot;. Key tokens are listed below.</span>
<span class="sd">           &quot;gate&quot;: the type of gate</span>
<span class="sd">           &quot;sigout&quot;: the name of the line the gate drives</span>
<span class="sd">           &quot;sigin&quot;: one of the fanin signal lines</span>
<span class="sd">           &quot;sigend&quot;: the final fanin signal line</span>

<span class="sd">        Args:</span>
<span class="sd">           line (str): String representing a single line from an ISCAS</span>
<span class="sd">              circuit file.</span>

<span class="sd">        Yields:</span>
<span class="sd">           str: Meaningful token describing a subsection of the line.</span>
<span class="sd">           str: Data associated with the token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Note: patterns are applied in order</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;comment&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;#.*&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s">&#39;sigout&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;.*=&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s">&#39;gate&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;.*\(&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s">&#39;sigin&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;.*?,&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s">&#39;sigend&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;.*?\)&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s">&#39;whitespace&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\W&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;.&#39;</span><span class="p">))]</span>

        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tokentype</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">():]</span>
                    <span class="k">yield</span> <span class="n">tokentype</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">break</span>
</div>
<div class="viewcode-block" id="Fault"><a class="viewcode-back" href="../cframe.html#cframe.Fault">[docs]</a><span class="k">class</span> <span class="nc">Fault</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fault implements a representation of a single stuck line fault.</span>

<span class="sd">    This class is a lightweight representation of a single stuck line fault.</span>
<span class="sd">    Only gate names (not references to the actual Gate objects) should be</span>
<span class="sd">    stored; as such, faults represented by this class require an external data</span>
<span class="sd">    structure (such as the gatemap of a Circuit object) in order to have full</span>
<span class="sd">    meaning.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       stem (str): Name corresponding to the stem line of the fault.</span>
<span class="sd">       branch (str): Name corresponding to the branch line of the fault. If</span>
<span class="sd">          None, the fault is a stem line fault; otherwise the fault is a branch</span>
<span class="sd">          line fault.</span>
<span class="sd">       value (Roth): Roth object representing the stuck value of the line.</span>
<span class="sd">          Should be either Roth.Zero or Roth.One.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">stem</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new fault.</span>

<span class="sd">        Args:</span>
<span class="sd">           value (Roth): Stuck value of the fault.</span>
<span class="sd">           stem (str): Name of the gate of the stem.</span>
<span class="sd">           branch (str): Name of the gate of the branch (optional). If no branch</span>
<span class="sd">              is provided the fault defaults to a stem line fault.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stem</span> <span class="o">=</span> <span class="n">stem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">branch</span> <span class="o">=</span> <span class="n">branch</span>
    
<div class="viewcode-block" id="Fault.__str__"><a class="viewcode-back" href="../cframe.html#cframe.Fault.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create concise string representing fault.</span>

<span class="sd">        Returns:</span>
<span class="sd">           str: String representing fault.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_branch</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s">&quot;-&gt;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch</span> <span class="o">+</span> <span class="s">&quot; stuck-at &quot;</span> <span class="o">+</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s">&quot; stuck-at &quot;</span> <span class="o">+</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="Fault.is_branch"><a class="viewcode-back" href="../cframe.html#cframe.Fault.is_branch">[docs]</a>    <span class="k">def</span> <span class="nf">is_branch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return boolean indicating if fault is a branch line fault.</span>

<span class="sd">        Returns:</span>
<span class="sd">           bool: True if fault is a branch line fault.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    
</div></div>
<div class="viewcode-block" id="FaultClass"><a class="viewcode-back" href="../cframe.html#cframe.FaultClass">[docs]</a><span class="k">class</span> <span class="nc">FaultClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FaultClass implements a representation of a fault class.</span>

<span class="sd">    This class is a lightweight representation of a single fault class with its</span>
<span class="sd">    equivalence and dominance relationships.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       equivalent (list): List of equivalent Fault objects.</span>
<span class="sd">       dominated (list): List of dominate FaultClass objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fault</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new FaultClass.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">           fault (Fault): Representative fault for the new FaultClass object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">equivalent</span> <span class="o">=</span> <span class="p">[</span><span class="n">fault</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dominated</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="FaultClass.add_equivalent"><a class="viewcode-back" href="../cframe.html#cframe.FaultClass.add_equivalent">[docs]</a>    <span class="k">def</span> <span class="nf">add_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eqfault</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an equivalent fault to the fault class.</span>

<span class="sd">        Args:</span>
<span class="sd">           eqfault (Fault): Equivalent fault to be added.</span>

<span class="sd">        Raises:</span>
<span class="sd">           TypeError: If eqfault is not a Fault object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eqfault</span><span class="p">,</span> <span class="n">Fault</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">equivalent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eqfault</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Attempted to add non-Fault to equivalents&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FaultClass.add_dominated"><a class="viewcode-back" href="../cframe.html#cframe.FaultClass.add_dominated">[docs]</a>    <span class="k">def</span> <span class="nf">add_dominated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domfclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a dominated fault class to the current fault class.</span>

<span class="sd">        Args:</span>
<span class="sd">           domfclass (FaultClass): Dominated fault class to be added.</span>

<span class="sd">        Raises:</span>
<span class="sd">           TypeError: If domfclass is not a FaultClass object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domfclass</span><span class="p">,</span> <span class="n">FaultClass</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dominated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domfclass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Attempted to add non-FaultClass to dominated&quot;</span><span class="p">)</span>
            </div>
<div class="viewcode-block" id="FaultClass.write"><a class="viewcode-back" href="../cframe.html#cframe.FaultClass.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filep</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write fault class contents to file.</span>

<span class="sd">        Note: this function will recursively print out all of the dominated</span>
<span class="sd">        FaultClass objects. The &#39;level&#39; argument is used to determine the</span>
<span class="sd">        proper indentation, and should only be used when recursively printing</span>
<span class="sd">        dominated FaultClass objects.</span>

<span class="sd">        Args:</span>
<span class="sd">           filep (file object): Opened file to which fault class will be</span>
<span class="sd">              written.</span>
<span class="sd">           level (int): Integer that determines indentation level in the printed</span>
<span class="sd">              output (default 0). The default value should almost always be used</span>
<span class="sd">              when calling this function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pad</span> <span class="o">=</span> <span class="n">level</span> <span class="o">*</span> <span class="s">&quot;    &quot;</span>

        <span class="c"># Print representative fault with proper header</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">filep</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pad</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;-D&gt; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filep</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pad</span><span class="o">+</span><span class="s">&quot;H&gt; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="c"># Print equivalent faults</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">filep</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pad</span><span class="o">+</span><span class="s">&quot;   Equivalent faults:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fault</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">equivalent</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">filep</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pad</span><span class="o">+</span><span class="s">&quot;   E&gt; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fault</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="c"># Print dominated faults</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dominated</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">filep</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pad</span><span class="o">+</span><span class="s">&quot;   Dominates:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">domfclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dominated</span><span class="p">:</span>
                <span class="n">domfclass</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filep</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Command"><a class="viewcode-back" href="../cframe.html#cframe.Command">[docs]</a><span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Command represents commands read from a file as an enumerated class.</span>

<span class="sd">    There are 6 recognized commands as listed below:</span>
<span class="sd">       - Fault</span>
<span class="sd">       - Imply</span>
<span class="sd">       - Dfront</span>
<span class="sd">       - Jfront</span>
<span class="sd">       - Xpath</span>
<span class="sd">       - Display</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Fault</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Imply</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Dfront</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">Jfront</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">Xpath</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">Display</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Command.read_commands"><a class="viewcode-back" href="../cframe.html#cframe.Command.read_commands">[docs]</a>    <span class="k">def</span> <span class="nf">read_commands</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read a command file.</span>

<span class="sd">        This function yields each command in order as they are read from</span>
<span class="sd">        the provided file. The yielded result is a tuple of size 1 or 3,</span>
<span class="sd">        depending on the specified command:</span>
<span class="sd">           - Fault or Imply: (Command, gatename (str), val (Roth))</span>
<span class="sd">           - Other: (Command,)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">           filename (str): Name of the command file to read.</span>

<span class="sd">        Yields:</span>
<span class="sd">           tuple: A tuple of length 1 or 3 depending on the Command.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Open file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filep</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filep</span><span class="p">:</span>

                <span class="c"># Skip if comment</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="c"># Handle commands.</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;fault_site&#39;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&#39;[\(,\)]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">Command</span><span class="o">.</span><span class="n">Fault</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Roth</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>

                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;imply&#39;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&#39;[\(,\)]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">Command</span><span class="o">.</span><span class="n">Imply</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Roth</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>

                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;D_frontier&#39;</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">Command</span><span class="o">.</span><span class="n">Dfront</span><span class="p">,)</span>

                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;J_frontier&#39;</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">Command</span><span class="o">.</span><span class="n">Jfront</span><span class="p">,)</span>
                    
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;x-path&#39;</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">Command</span><span class="o">.</span><span class="n">Xpath</span><span class="p">,)</span>

                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;display_lines&#39;</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">Command</span><span class="o">.</span><span class="n">Display</span><span class="p">,)</span>

</div></div>
<div class="viewcode-block" id="BridgeFault"><a class="viewcode-back" href="../cframe.html#cframe.BridgeFault">[docs]</a><span class="k">class</span> <span class="nc">BridgeFault</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;BridgeFault implements a representation of a bridge fault.</span>

<span class="sd">    Supported bridge fault types are stored as the class attribute BridgeFault.types:</span>
<span class="sd">       - AND</span>
<span class="sd">       - OR</span>

<span class="sd">    Attributes:</span>
<span class="sd">       sites (tuple): Tuple of strings corresponding to the names of the two (or more)</span>
<span class="sd">          locations of the bridge fault.</span>
<span class="sd">       bridgetype (str): String representing the type of bridge fault, should be one of</span>
<span class="sd">          the types in BridgeFault.types.</span>
<span class="sd">       flag (bool): Boolean flag used to track status of BridgeFaults during the course</span>
<span class="sd">          of some operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;AND&quot;</span><span class="p">,</span>
             <span class="s">&quot;OR&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sites</span><span class="p">,</span> <span class="n">bridgetype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iniitalize a new bridge fault.</span>

<span class="sd">        Args:</span>
<span class="sd">           sites (iterable): Iterable containing the names of the locations of the</span>
<span class="sd">              bridge fault. There should always be more than one location.</span>
<span class="sd">           bridgetype (str): Type of the bridge fault, should be one of BridgeFault.types.</span>

<span class="sd">        Raises:</span>
<span class="sd">           KeyError: If bridgetype is not one of BridgeFault.types</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sites</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sites</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="k">if</span> <span class="n">bridgetype</span> <span class="ow">in</span> <span class="n">BridgeFault</span><span class="o">.</span><span class="n">types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bridgetype</span> <span class="o">=</span> <span class="n">bridgetype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Invalid bridgetype: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">bridgetype</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="BridgeFault.read_bridges"><a class="viewcode-back" href="../cframe.html#cframe.BridgeFault.read_bridges">[docs]</a>    <span class="k">def</span> <span class="nf">read_bridges</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read a bridge fault file into a list of bridge faults.</span>

<span class="sd">        Args:</span>
<span class="sd">           filename (str): Name of file containing bridge faults.</span>
<span class="sd">        Returns:</span>
<span class="sd">           list: A list of BridgeFaults corresponding to the bridge faults in the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bfaults</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Open file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filep</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filep</span><span class="p">:</span>

                <span class="c"># Split line</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">site1</span><span class="p">,</span> <span class="n">site2</span><span class="p">,</span> <span class="n">bridgetype</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c"># Create sites</span>
                <span class="n">sites</span> <span class="o">=</span> <span class="p">(</span><span class="n">site1</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">site2</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                
                <span class="c"># Create BridgeFault object</span>
                <span class="n">bf</span> <span class="o">=</span> <span class="n">BridgeFault</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="n">bridgetype</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="c"># Append to bfaults list</span>
                <span class="n">bfaults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bfaults</span>

</div></div>
<div class="viewcode-block" id="read_testset"><a class="viewcode-back" href="../cframe.html#cframe.read_testset">[docs]</a><span class="k">def</span> <span class="nf">read_testset</span><span class="p">(</span><span class="n">testfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read testset from file.</span>

<span class="sd">    Arguments:</span>
<span class="sd">       testfile (str): Name of file containing testset.</span>

<span class="sd">    Returns:</span>
<span class="sd">       list: A list of tuples of Roth values, each tuple representing a single test.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">testset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">testfile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filep</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filep</span><span class="p">:</span>

            <span class="c"># Each line represents a single test</span>
            <span class="n">test</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c"># Split line</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="p">(</span><span class="n">tnum</span><span class="p">,</span> <span class="n">in_vec</span><span class="p">,</span> <span class="n">out_vec</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c"># Build test tuple</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">in_vec</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&quot;X&quot;</span><span class="p">:</span>
                    <span class="n">test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Roth</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Roth</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

            <span class="c"># Append test vector to testset</span>
            <span class="n">testset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">testset</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Benjamin Niewenhuis.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>